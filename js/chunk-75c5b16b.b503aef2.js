(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-75c5b16b","HistoryItem","Collection","Dataset","EditableLabel","FunctionIcon"],{"02aa":function(t,e,n){"use strict";var a=n("bec7"),r=n.n(a);r.a},"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"22b7":function(t,e,n){},3281:function(t,e,n){"use strict";var a=n("22b7"),r=n.n(a);r.a},"39a9":function(t,e,n){"use strict";var a=n("5cb0"),r=n.n(a);r.a},4424:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"galaxy-history-item",attrs:{draggable:t.draggable},on:{"&dragstart":function(e){return t.dragstart(e)}}},[t._t("before"),n("span",{staticClass:"galaxy-history-item-hid"},[t._v(t._s(t.model.hid))]),n("EditableLabel",{ref:"label",staticClass:"galaxy-history-item-name",attrs:{value:t.model.name,placeholder:"Enter a name to identify this dataset"},on:{update:t.update_label}}),t.model.upload_progress<100||"queued"===t.model.state||"running"===t.model.state?n("b-progress",{class:"galaxy-history-item-progress w-100 "+this.model.state,attrs:{max:100,variant:"info",striped:"",animated:""}},[n("b-progress-bar",{staticClass:"galaxy-history-item-progressbar",attrs:{value:t.model.upload_progress}})],1):t._e(),t.working?n("span",{staticClass:"galaxy-history-item-status"},[n("b-spinner",{attrs:{small:"",type:"grow",label:t.working}}),t._v(" "+t._s(t.working))],1):t._e(),t._t("default"),n("HistoryItemFunctions",t._g({attrs:{item:this},on:{"galaxy-history-item-rename":function(e){return t.$refs.label.start_edit()}},scopedSlots:t._u([{key:"default",fn:function(e){return[t._t("history_item_functions",null,{item:e.item,listeners:t.$listeners})]}}],null,!0)},t.$listeners)),t._t("after")],2)},r=[],i=(n("a4d3"),n("4de4"),n("b0c0"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),s=n("d86b"),o=n("ae96"),l=n("8a70");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(i["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d="application/vnd.galaxy.historycontent+json",f={name:"HistoryItem",components:{EditableLabel:l["default"],HistoryItemFunctions:o["default"]},data:function(){return{}},props:{draggable:{type:Boolean,default:!1},model:{type:[s["HistoryDatasetAssociation"],s["HistoryDatasetCollectionAssociation"]],required:!0}},computed:{working:function(){return"auto"===this.model.file_ext?"Verifying data type":"error"===this.model.state?"Error":null}},methods:{update_label:function(t){this.model.name=t,this.model.put(["name"])},dragstart:function(t){t.dataTransfer.setData(d,JSON.stringify(u({hist_id:this.model.history_id},this.model.toInput()))),t.dataTransfer.effectAllowed=this.model instanceof s["HistoryDatasetAssociation"]?"move":"copyMove"}},mounted:function(){if(this.model.hid>this.model.constructor.ghost_hid){var t=this;t.model.poll_state((function(){return"auto"!==t.model.extension}),void 0,3e3)}},beforeDestroy:function(){this.model&&this.model.stop_polling()}},h=f,p=(n("39a9"),n("2877"));n.d(e,"HISTCONTENT_MIME",(function(){return d}));var m=Object(p["a"])(h,a,r,!1,null,"4f1e136f",null);e["default"]=m.exports},"5c0f":function(t,e,n){"use strict";var a=n("cf89"),r=n.n(a);r.a},"5ca1":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"galaxy-history-contents"},[n("b-row",{staticClass:"galaxy-history-contents-head"},[n("b-input-group",{attrs:{size:"sm",prepend:"Filter"}},[n("b-form-input",{attrs:{type:"search",placeholder:"Type to Search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),n("b-input-group-append",[n("b-button",{attrs:{disabled:!t.search,title:"Previous match"},on:{click:function(e){return t.search_next(!0)}}},[n("i",{staticClass:"icon icon-prev"})]),n("b-button",{attrs:{disabled:!t.search,title:"Next match"},on:{click:function(e){return t.search_next(!1)}}},[n("i",{staticClass:"icon icon-next"})])],1)],1),n("FunctionIcon",{attrs:{label:"Upload",description:"Select a dataset to upload",icon:"icon-file-upload",action:t.show_upload}}),n("input",{ref:"upload",attrs:{type:"file",hidden:"",multiple:"",accept:t.accepted_upload_types.map((function(t){return"."+t}))},on:{input:function(e){return e.preventDefault(),t.dragdrop(e)}}})],1),n("b-row",{staticClass:"galaxy-history-contents-list"},[n("b-table",{ref:"table",attrs:{"show-empty":"",small:"",borderless:"","sticky-header":"100%","per-page":"0","primary-key":"key",items:t.items,busy:t.isLoading,selectable:t.selectable,"select-mode":"range",fields:["item"],"sort-by":"hid","empty-text":"Drag and drop files here to upload","thead-class":"hidden_header","tbody-tr-class":t.rowClass},on:{"row-selected":t.row_selected},nativeOn:{dragover:function(e){return e.preventDefault(),t.drag(e,!0)},dragleave:function(e){return t.drag(e,!1)},dragexit:function(e){return t.drag(e,!1)},drop:function(e){return e.preventDefault(),t.dragdrop(e)},keydown:function(e){return t.handle_hotkey(e)}},scopedSlots:t._u([{key:"cell(item)",fn:function(e){return["dataset"===e.value.history_content_type?n("DatasetItem",{class:{"table-danger":e.value.state in e.value.constructor.error_states},attrs:{model:e.value,draggable:!0}}):"dataset_collection"===e.value.history_content_type?n("CollectionItem",{attrs:{model:e.value,draggable:!0}}):t._e()]}}])},[n("template",{slot:"table-busy"},[n("div",{staticClass:"text-center loading-spinner"},[n("b-spinner",{staticClass:"align-middle"}),n("strong",[t._v("Loading...")])],1)]),n("template",{slot:"[]"},[t._v("Unexpected column")])],2)],1)],1)},r=[],i=(n("a4d3"),n("e01a"),n("d28b"),n("99af"),n("4de4"),n("c740"),n("caad"),n("d81d"),n("4e82"),n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("2532"),n("3ca3"),n("466d"),n("841c"),n("ddb0"),n("3835")),s=n("1f26"),o=n("d86b"),l=n("ab69"),c=n("dc90"),u=n("6d1e"),d=n("4424"),f={genbank:"genbank",gbk:"genbank",embl:"embl",gbff:"genbank",newick:"newick",nwk:"newick"};function h(t,e){return e.hid.toString()===t||e.name.includes(t)}var p={name:"HistoryContents",components:{FunctionIcon:u["default"],CollectionItem:c["default"],DatasetItem:l["default"]},props:{history:{validator:function(t){return t instanceof s["History"]||null===t},required:!0},filter:{type:Function,default:function(){return!0}},value:{type:Array,default:function(){return[]}},accepted_upload_types:{type:Array,default:function(){return[]}},selectable:{type:Boolean,default:function(){return!1}}},data:function(){return{upload_dragging:!1,search:"",search_target:null}},computed:{items:function(){var t=this;return null===this.history||this.upload_dragging?[]:this.history.datasets.concat(this.history.collections).filter((function(e){return!e.deleted&&t.filter(e)})).sort((function(t,e){return t.hid===t.constructor.ghost_hid?-1:e.hid-t.hid})).reduce((function(t,e){return t.push({item:e,hid:e.hid,key:e.id}),t}),[])},isLoading:function(){return null===this.history||!this.history.contentsFetched}},methods:{rowClass:function(t,e){if(t&&"row"===e)return t.item===this.search_target?"search-target":void 0},show_upload:function(){this.$refs.upload.click()},row_selected:function(t){this.$emit("input",t.map((function(t){return t.item})))},search_next:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e?1:-1,a=this.items.findIndex((function(e){return e.item===t.search_target}));if(-1!==a){a+=n,a<0?a=e?0:this.items.length-1:a>=this.items.length&&(a=e?0:this.items.length-1);var r=a;do{var i=this.items[a].item;if(h(this.search,i)){this.search_target=i;var s=this.$refs.table.$el.querySelector("tbody"),o=s.querySelectorAll("tr")[this.items.length-a-1];return void o.scrollIntoView()}a+=n,a<0?a=this.items.length-1:a>=this.items.length&&(a=0)}while(a!==r)}this.search_target=null},drag:function(t,e){t.dataTransfer&&t.dataTransfer.types.includes(d["HISTCONTENT_MIME"])||(this.upload_dragging=e)},dragdrop:function(t){if(!t.dataTransfer||!t.dataTransfer.types.includes(d["HISTCONTENT_MIME"]))return this.uploadHandler(t);if(t.dataTransfer){var e=JSON.parse(t.dataTransfer.getData(d["HISTCONTENT_MIME"]));this.history.id!==e.hist_id&&this.history.copy_into(e,"copy"===t.dataTransfer.dropEffect)}},uploadHandler:function(t){if(this.upload_dragging=!1,null!==this.history){var e=t.dataTransfer?t.dataTransfer.files:t.target.files,n=[],a=!0,r=!1,i=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=c.name.match(/[^.]+$/);if(!this.accepted_upload_types.length||u&&this.accepted_upload_types.includes(u[0]))n.push(c);else{var d=c.name+Math.floor(Math.random()*Math.pow(10,16)).toString();o["HistoryDatasetAssociation"].insert({data:{id:d,file:c,name:"Incorrect file format: "+c.name,hid:o["HistoryDatasetAssociation"].ghost_hid,history_id:this.history.id,extension:this.accepted_upload_types[0],state:"failed"}})}}}catch(m){r=!0,i=m}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}var h=this,p=function(){var t=!0,e=!1,a=void 0;try{for(var r,i=n[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var s=r.value,o=s.name.match(/[^.]+$/);o&&f.hasOwnProperty(o[0])?h.history.fileUpload(s,f[o[0]]):h.history.fileUpload(s)}}catch(m){e=!0,a=m}finally{try{t||null==i.return||i.return()}finally{if(e)throw a}}};"upload"in this.$listeners?this.$emit("upload",{history:this.history,files:n,default:p}):p()}},handle_hotkey:function(t){(t.ctrlKey||t.metaKey)&&"a"===t.key&&(this.$refs.table.selectAllRows(),t.preventDefault(),t.stopPropagation())},clearSelected:function(){this.$refs.table.clearSelected()}},watch:{search:function(){this.search?null!==this.search_target&&h(this.search,this.search_target)||this.search_next():this.search_target=null}},mounted:function(){if(this.value.length){var t=!0,e=!1,n=void 0;try{for(var a,r=this.items.elements()[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=Object(i["a"])(a.value,2),o=s[0],l=s[1];this.value.includes(l)&&this.$refs.table.selectRow(o)}}catch(c){e=!0,n=c}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}}}},m=p,y=(n("5c0f"),n("2877")),b=Object(y["a"])(m,a,r,!1,null,"1a691e3a",null);e["default"]=b.exports},"5cb0":function(t,e,n){},"6d1e":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-link",{staticClass:"galaxy-function",attrs:{title:t.description,href:""},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.do_action(e)}}},[n("i",{staticClass:"galaxy-function-icon",class:t.icon}),t._v(" "+t._s(t.label)+" ")])},r=[],i={name:"FunctionIcon",props:{icon:{type:String,default:""},label:{type:String,default:""},description:{type:String,default:""},action:{type:Function,required:!0}},methods:{do_action:function(){this.action.call(this)}}},s=i,o=n("2877"),l=Object(o["a"])(s,a,r,!1,null,"12118e96",null);e["default"]=l.exports},"734d":function(t,e,n){"use strict";var a,r,i=n("6d1e"),s=n("4424"),o={extends:i["default"],name:"Remove",props:{icon:{type:String,default:"icon-trash"},label:{type:String,default:"Remove"},description:{type:String,default:"Remove this item from the history"},item:{type:s["default"],required:!0},action:{type:Function,required:!1,default:function(){this.item.model.delete(),this.$emit("galaxy-history-item-deleted",this.item.model)}}}},l=o,c=n("2877"),u=Object(c["a"])(l,a,r,!1,null,"f2ae40d0",null);e["a"]=u.exports},"841c":function(t,e,n){"use strict";var a=n("d784"),r=n("825a"),i=n("1d80"),s=n("129f"),o=n("14c3");a("search",1,(function(t,e,n){return[function(e){var n=i(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,n):new RegExp(e)[t](String(n))},function(t){var a=n(e,t,this);if(a.done)return a.value;var i=r(t),l=String(this),c=i.lastIndex;s(c,0)||(i.lastIndex=0);var u=o(i,l);return s(i.lastIndex,c)||(i.lastIndex=c),null===u?-1:u.index}]}))},"8a70":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"editable-label"},[null===t.edited_label?[t._v(t._s(t.value))]:n("b-input",{ref:"editbox",attrs:{pattern:t.pattern,formatter:function(t){return t.trim()},placeholder:t.placeholder,autofocus:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.stop_edit(e)},blur:t.stop_edit,click:function(t){t.stopPropagation()}},model:{value:t.edited_label,callback:function(e){t.edited_label=e},expression:"edited_label"}})],2)},r=[],i={name:"EditableLabel",props:{value:{type:String,required:!0},placeholder:{type:String,default:""},pattern:{type:String,default:".+"}},data:function(){return{edited_label:null}},methods:{start_edit:function(){var t=this;this.edited_label=this.value,this.$nextTick((function(){t.$refs.editbox.focus(),t.$refs.editbox.select()}))},stop_edit:function(){null!==this.edited_label&&this.$emit("update",this.edited_label),this.edited_label=null},cancel_edit:function(){this.edited_label=null}}},s=i,o=(n("02aa"),n("2877")),l=Object(o["a"])(s,a,r,!1,null,"7f2facec",null);e["default"]=l.exports},ab69:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("HistoryItem",t._b({},"HistoryItem",t.$props,!1))},r=[],i=n("4424"),s={extends:i["default"],name:"Dataset",components:{HistoryItem:i["default"]},data:function(){return{}},props:{},computed:{},methods:{},mounted:function(){}},o=s,l=n("2877"),c=Object(l["a"])(o,a,r,!1,null,"6e760062",null);e["default"]=c.exports},ae96:function(t,e,n){"use strict";n.r(e);var a,r,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-button-group",{staticClass:"galaxy-history-item-functions"},[t._t("default",null,{item:t.item}),n("RenameHistoryItem",t._g({attrs:{item:t.item}},t.$listeners)),n("RemoveHistoryItem",t._g({attrs:{item:t.item}},t.$listeners))],2)},s=[],o=n("734d"),l=n("6d1e"),c=n("4424"),u={extends:l["default"],name:"Rename",props:{icon:{type:String,default:"icon-rename"},label:{type:String,default:"Rename"},description:{type:String,default:"Rename this item"},item:{type:c["default"],required:!0},action:{type:Function,required:!1,default:function(){this.$emit("galaxy-history-item-rename",this.item.model)}}}},d=u,f=n("2877"),h=Object(f["a"])(d,a,r,!1,null,"7fe66007",null),p=h.exports,m={name:"HistoryItemFunctions",components:{RemoveHistoryItem:o["a"],RenameHistoryItem:p},props:{item:{type:c["default"],required:!0}}},y=m,b=(n("3281"),Object(f["a"])(y,i,s,!1,null,"4bc03d8a",null));e["default"]=b.exports},bec7:function(t,e,n){},c740:function(t,e,n){"use strict";var a=n("23e7"),r=n("b727").findIndex,i=n("44d2"),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),a({target:"Array",proto:!0,forced:o},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(s)},cf89:function(t,e,n){},dc90:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("HistoryItem",t._b({ref:"history_item"},"HistoryItem",t.$props,!1),[n("span",[t._v(t._s(t.state))]),n("HistoryItemFunctions",[t._t("history_item_functions"),n("RemoveHistoryItem")],2)],1)},r=[],i=n("4424"),s=n("ae96"),o=n("734d"),l={extends:i["default"],name:"Collection",components:{HistoryItem:i["default"],HistoryItemFunctions:s["default"],RemoveHistoryItem:o["a"]}},c=l,u=n("2877"),d=Object(u["a"])(c,a,r,!1,null,"78169afd",null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-75c5b16b.b503aef2.js.map